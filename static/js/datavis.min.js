'use strict';function init(){request('/data').then(function(c){return{sessions:parseSessionData(c),sail:parseUsage(c,'sailSize'),board:parseUsage(c,'board'),spots:parseUsage(c,'spot')}}).then(function(c){renderBarChart(c.sessions,'session-amount'),renderBarChart(c.sail,'sail-usage'),renderBarChart(c.board,'board-usage'),renderBarChart(c.spots,'spot-visits')}).catch(function(c){return console.error(c)})}function request(c){return new Promise(function(e,f){var h=new XMLHttpRequest;h.onreadystatechange=function(){4===h.readyState&&200===h.status?e(JSON.parse(h.responseText)):404===h.status&&f(new Error('The server responded with 404, not found'))},h.open('GET',c,!0),h.send()})}function parseUsage(c,e){var f=[];return c.forEach(function(h,j){var k=!1;return 0===j?void f.push({name:h[e],count:1}):void(f.forEach(function(l){l.name===h[e]&&(l.count++,k=!0)}),!1==k&&f.push({name:h[e],count:1}))}),'sailSize'===e?f.sort(function(h,j){return h.name-j.name}):f.sort(function(h,j){return j.count-h.count}),f}function parseSessionData(c){var e=[{name:'january',count:0},{name:'februari',count:0},{name:'march',count:0},{name:'april',count:0},{name:'may',count:0},{name:'june',count:0},{name:'july',count:0},{name:'august',count:0},{name:'september',count:0},{name:'october',count:0},{name:'november',count:0},{name:'december',count:0}];return c.forEach(function(f){var j=f.date.split('-')[1];e[j-1].count++}),e}function renderBarChart(c,e){var l={width:document.getElementById(e).clientWidth,height:500},m={top:10,right:0,bottom:30,left:30},f=d3.scaleBand().domain(c.map(function(o){return o.name})).range([m.left,l.width-m.right]).padding(0.1),h=d3.scaleLinear().domain([0,d3.max(c,function(o){return o.count})]).nice().range([l.height-m.bottom,m.top]),n=d3.select('#'+e).attr('width',l.width).attr('height',l.height);n.append('g').attr('fill','steelblue').selectAll('rect').data(c).enter().append('rect').attr('x',function(o){return f(o.name)}).attr('y',function(o){return h(o.count)}).attr('height',function(o){return h(0)-h(o.count)}).attr('width',f.bandwidth()),n.append('g').call(function j(o){return o.attr('transform','translate(0,'+(l.height-m.bottom)+')').call(d3.axisBottom(f).tickSizeOuter(0))}),n.append('g').call(function k(o){return o.attr('transform','translate('+m.left+',0)').call(d3.axisLeft(h)).call(function(p){return p.select('.domain').remove()}).call(d3.axisLeft(h).ticks(d3.max(c,function(p){return p.count})))})}init();
