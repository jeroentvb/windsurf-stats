'use strict';function init(){request('/data').then(function(a){return{sail:parseUsage(a,'sailSize'),board:parseUsage(a,'board')}}).then(function(a){renderUsageGraph(a.sail,'sail-usage'),renderUsageGraph(a.board,'board-usage')}).catch(function(a){return console.error(a)})}function request(a){return new Promise(function(b,c){var e=new XMLHttpRequest;e.onreadystatechange=function(){4===e.readyState&&200===e.status?b(JSON.parse(e.responseText)):404===e.status&&c(new Error('The server responded with 404, not found'))},e.open('GET',a,!0),e.send()})}function parseUsage(a,b){var c=[];return a.forEach(function(e,f){var h=!1;return 0===f?void c.push({name:e[b],count:1}):void(c.forEach(function(j){j.name===e[b]&&(j.count++,h=!0)}),!1==h&&c.push({name:e[b],count:1}))}),c.reverse()}function renderUsageGraph(a,b){var j={width:document.getElementById(b).clientWidth,height:500},k={top:10,right:0,bottom:30,left:30},c=d3.scaleBand().domain(a.map(function(m){return m.name})).range([k.left,j.width-k.right]).padding(0.1),e=d3.scaleLinear().domain([0,d3.max(a,function(m){return m.count})]).nice().range([j.height-k.bottom,k.top]),l=d3.select('#'+b).attr('width',j.width).attr('height',j.height);l.append('g').attr('fill','steelblue').selectAll('rect').data(a).enter().append('rect').attr('x',function(m){return c(m.name)}).attr('y',function(m){return e(m.count)}).attr('height',function(m){return e(0)-e(m.count)}).attr('width',c.bandwidth()),l.append('g').call(function f(m){return m.attr('transform','translate(0,'+(j.height-k.bottom)+')').call(d3.axisBottom(c).tickSizeOuter(0))}),l.append('g').call(function h(m){return m.attr('transform','translate('+k.left+',0)').call(d3.axisLeft(e)).call(function(n){return n.select('.domain').remove()}).call(d3.axisLeft(e).ticks(d3.max(a,function(n){return n.count})))})}init();
