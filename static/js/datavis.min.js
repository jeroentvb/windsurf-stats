"use strict";var months=["january","february","march","april","may","june","july","august","september","october","november","december"];function checkLocalstorage(){var t="test";try{localStorage.setItem(t,t);localStorage.removeItem(t);return true}catch(t){return false}}var localstorage=checkLocalstorage();getData().then(function(t){document.getElementById("total-sessions").textContent=t.length;return{sessions:parseSessionData(t),sail:parseUsage(t,"sailSize"),board:parseUsage(t,"board"),spots:parseUsage(t,"spot")}}).then(function(t){renderBarChart(t.sessions,"session-amount");renderBarChart(t.sail,"sail-usage");renderBarChart(t.board,"board-usage");renderBarChart(t.spots,"spot-visits")}).catch(function(t){return console.error(t)});function getData(t){return new Promise(function(e,n){if(localstorage&&localStorage.getItem("sessionData")){var t=JSON.parse(localStorage.getItem("sessionData"));e(t)}else{request("/data").then(function(t){if(localStorage)localStorage.setItem("sessionData",JSON.stringify(t));e(t)}).catch(function(t){return n(t)})}})}function request(a){return new Promise(function(t,e){var n=new XMLHttpRequest;n.onreadystatechange=function(){if(n.readyState===4&&n.status===200){t(JSON.parse(n.responseText))}else if(n.status===404){e(new Error("The server responded with 404, not found"))}};n.open("GET",a,true);n.send()})}function parseUsage(t,a){var r=[];t.forEach(function(e,t){var n=false;if(t===0){r.push({name:e[a],count:1});return}r.forEach(function(t){if(t.name===e[a]){t.count++;n=true}});if(n===false){r.push({name:e[a],count:1})}});if(a==="sailSize"){r.sort(function(t,e){return t.name-e.name})}else{r.sort(function(t,e){return e.count-t.count})}return r}function parseSessionData(t){var m=[];t.sort(function(t,e){var n=t.date.split("-").reverse();var a=e.date.split("-").reverse();return new Date(n)-new Date(a)});t.forEach(function(t,e){var n=parseInt(t.date.split("-")[1]);var a=parseInt(t.date.split("-")[2]);var r="".concat(months[n-1]," ").concat(a);var o=false;if(e===0){m.push({name:r,count:1,month:n});return}m.forEach(function(t){if(t.name===r){t.count++;o=true}});if(!o){var s=m[m.length-1].month;if(s+1===13){m.push({name:r,count:1,month:n})}else if(s+1!==n){var c=n-s-1;if(c<0){var u=12-s;var i=n-1;for(var l=0;l<u;l++){m.push({name:months[s+l]?"".concat(months[s+l]," ").concat(a-1):"".concat(months[11]," ").concat(a-1),count:0,month:s+(1+l)===13?1:s+(1+l)})}for(var h=0;h<i;h++){m.push({name:"".concat(months[h]," ").concat(a),count:0,month:h+1})}m.push({name:r,count:1,month:n})}else{for(var f=c;f>0;f--){m.push({name:months[n-(1+f)]?"".concat(months[n-(1+f)]," ").concat(a):"".concat(months[11]," ").concat(a-1),count:0,month:n-(1+f)===0?12:n-(1+f)})}m.push({name:r,count:1,month:n})}}else{m.push({name:r,count:1,month:n})}}});return m}function renderBarChart(e,t){var n={width:document.getElementById(t).clientWidth,height:500};var a={top:10,right:0,bottom:30,left:30};var r=d3.scaleBand().domain(e.map(function(t){return t.name})).range([a.left,n.width-a.right]).padding(.1);var o=d3.scaleLinear().domain([0,d3.max(e,function(t){return t.count})]).nice().range([n.height-a.bottom,a.top]);var s=function xAxis(t){return t.attr("transform","translate(0,".concat(n.height-a.bottom,")")).call(d3.axisBottom(r).tickSizeOuter(0))};var c=function yAxis(t){return t.attr("transform","translate(".concat(a.left,",0)")).call(d3.axisLeft(o)).call(function(t){return t.select(".domain").remove()}).call(d3.axisLeft(o).ticks(d3.max(e,function(t){return t.count})))};var u=d3.select("#".concat(t)).attr("width",n.width).attr("height",n.height);u.append("g").attr("fill","steelblue").selectAll("rect").data(e).enter().append("rect").attr("x",function(t){return r(t.name)}).attr("y",function(t){return o(t.count)}).attr("height",function(t){return o(0)-o(t.count)}).attr("width",r.bandwidth());u.append("g").call(s);u.append("g").call(c)}
