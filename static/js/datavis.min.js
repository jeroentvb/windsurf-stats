'use strict';var months=['january','february','march','april','may','june','july','august','september','october','november','december'];function init(){request('/data').then(function(e){return document.getElementById('total-sessions').textContent=e.length,{sessions:parseSessionData(e),sail:parseUsage(e,'sailSize'),board:parseUsage(e,'board'),spots:parseUsage(e,'spot')}}).then(function(e){renderBarChart(e.sessions,'session-amount'),renderBarChart(e.sail,'sail-usage'),renderBarChart(e.board,'board-usage'),renderBarChart(e.spots,'spot-visits')}).catch(function(e){return console.error(e)})}function request(e){return new Promise(function(f,h){var j=new XMLHttpRequest;j.onreadystatechange=function(){4===j.readyState&&200===j.status?f(JSON.parse(j.responseText)):404===j.status&&h(new Error('The server responded with 404, not found'))},j.open('GET',e,!0),j.send()})}function parseUsage(e,f){var h=[];return e.forEach(function(j,k){var l=!1;return 0===k?void h.push({name:j[f],count:1}):void(h.forEach(function(m){m.name===j[f]&&(m.count++,l=!0)}),!1==l&&h.push({name:j[f],count:1}))}),'sailSize'===f?h.sort(function(j,k){return j.name-k.name}):h.sort(function(j,k){return k.count-j.count}),h}function parseSessionData(e){var f=[];return e.sort(function(h,j){var k=h.date.split('-').reverse(),l=j.date.split('-').reverse();return new Date(k)-new Date(l)}),e.forEach(function(h,j){var k=h.date.split('-')[1],l=h.date.split('-')[2],m=months[k-1]+' '+l,n=!1;return 0===j?void f.push({name:m,count:1}):void(f.forEach(function(o){o.name===m&&(o.count++,n=!0)}),!1==n&&f.push({name:m,count:1}))}),f}function renderBarChart(e,f){var m={width:document.getElementById(f).clientWidth,height:500},n={top:10,right:0,bottom:30,left:30},h=d3.scaleBand().domain(e.map(function(p){return p.name})).range([n.left,m.width-n.right]).padding(0.1),j=d3.scaleLinear().domain([0,d3.max(e,function(p){return p.count})]).nice().range([m.height-n.bottom,n.top]),o=d3.select('#'+f).attr('width',m.width).attr('height',m.height);o.append('g').attr('fill','steelblue').selectAll('rect').data(e).enter().append('rect').attr('x',function(p){return h(p.name)}).attr('y',function(p){return j(p.count)}).attr('height',function(p){return j(0)-j(p.count)}).attr('width',h.bandwidth()),o.append('g').call(function k(p){return p.attr('transform','translate(0,'+(m.height-n.bottom)+')').call(d3.axisBottom(h).tickSizeOuter(0))}),o.append('g').call(function l(p){return p.attr('transform','translate('+n.left+',0)').call(d3.axisLeft(j)).call(function(q){return q.select('.domain').remove()}).call(d3.axisLeft(j).ticks(d3.max(e,function(q){return q.count})))})}init();
